--- 
title: "name"
author: "Lingrui Luo (ll3356), Zijing Wang (zw2619), Di Ye (dy2404), Qiaoge Zhu (qz2383)"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
# bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
# github-repo: rstudio/bookdown-demo
# description: "This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook."
---

# Introduction

It is always hard to choose what exact cosmetic product do you want and is suitable for you, so we are here to help! This book analyzes 1472 product of 6 types and 116 brands, You can easily get the information you want on the products you are interested in and compare them to other products. We also provide recommendations for you based on information you provided. Let's get started!^[The data is found in https://github.com/jjone36/Cosmetic/tree/master/data]

```{r, echo = FALSE, message = FALSE, include = FALSE}
#librarys
library(readr)
library(dplyr)
library(plotly)
library(tidyverse)
library(tidyr)
library(ggplot2)
library(parcoords)
library(readr)
```

```{r, echo = FALSE, message = FALSE}
link <- "https://raw.githubusercontent.com/jjone36/Cosmetic/master/data/cosmetic_p.csv"
data <- read_csv(url(link))
```

We are hoping to answer the following 3 questions:

a) What chemical ingredients are used in the products with higher price and lower price respectively?

b) What products to recommend based on their prices, ranks, brands and skin types?

c) What are top 10 ingredients used for each types of skins?



# Top Ingredients

We try to figure out the top 10 chemical ingredients in cosmetics with low, medium, and high price. We rank the ingredients by their frequencies. If two chemical ingredients have same frequencies, we rank them by alphabetical order.

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
ingredients_func <- function(data, n) {
  ingredients <- data$ingredients
  ingredients <- strsplit(ingredients, ", ")
  unlist_ingredients <- factor(unlist(ingredients))
  unique_ingredients_count <- length(unique(unlist_ingredients))
  df <- tibble(ingredients = unlist_ingredients)
  return(df %>% 
    count(ingredients) %>% 
    mutate(Rank = row_number(-n)) %>%
    arrange(desc(n)) %>% 
    rename(times = n))
}

## yet to decide
summary(data$price)
low_price <- summary(data$price)[3]
medium_price <- summary(data$price)[4]
low_data <- data %>% filter(price <= low_price) %>% select(ingredients)
medium_data <- data %>% filter(price <= medium_price & price > low_price) %>% select(ingredients)
high_data <- data %>% filter(price > medium_price) %>% select(ingredients)

n <- 10
df_all <- ingredients_func(data, n) %>% slice(1:n)
df_low <- ingredients_func(low_data, n) %>% slice(1:n)
df_medium <- ingredients_func(medium_data, n) %>% slice(1:n)
df_high <- ingredients_func(high_data, n) %>% slice(1:n)

df <- df_all %>% rename(OverallIngredients = ingredients) %>% select(-times) %>% 
                 inner_join(df_low %>% rename(LowPriceIngredients = ingredients) %>% select(-times)) %>% 
                 inner_join(df_medium %>% rename(MediumPriceIngredients = ingredients) %>% select(-times)) %>% 
                 inner_join(df_high %>% rename(HighPriceIngredients = ingredients) %>% select(-times)) %>% 
                 select(Rank, everything())
knitr::kable(df)
```


# Skin Type

## Number of Product for Each Skin Type

```{r, echo = FALSE}
# data for each skin type
combination <- data %>% filter(data$Combination==1) %>% 
  select(Label, brand, name, price, rank) %>%
  mutate(skin_type='Combination')

dry <- data %>% filter(data$Dry==1) %>% 
  select(Label, brand, name, price, rank) %>% 
  mutate(skin_type='Dry')

normal <- data %>% filter(data$Normal==1) %>% 
  select(Label, brand, name, price, rank) %>% 
  mutate(skin_type='Normal')

oily <- data %>% filter(data$Oily==1) %>% 
  select(Label, brand, name, price, rank) %>%
  mutate(skin_type='Oily')

sensitive <- data %>% filter(data$Sensitive==1) %>% 
  select(Label, brand, name, price, rank) %>%
  mutate(skin_type='Sensitive')
```

```{r, echo = FALSE}
num_prod_df = data.frame(skin_type = c("Normal", "Combination", "Oily", "Dry", "Sensitive"), num_product = c(nrow(normal), nrow(combination), nrow(oily),nrow(dry),nrow(sensitive)))

ggplot(data=num_prod_df, aes(x=skin_type, y=num_product)) +
  geom_bar(stat="identity", width=0.5, fill = "#FF6666") + ggtitle("Number of Products for Each Skin Type") + xlab("Skin Type") + ylab("Number of Products")
```

There are most of products for the combination skin type while there are least for sensitive skin type.

To do: Add description of the plot

## Price Differences for Each Skin Type

# Price vs. Rank

```{r, echo = FALSE}
d <- rbind(combination, dry, normal, oily, sensitive) 
brand <- d %>% group_by(brand) %>% summarise(avg_price = sum(price)/n(),avg_rank = sum(rank)/n())
```

```{r, echo = FALSE}
avg_brand <- plot_ly(brand,
                     x=~avg_rank,
                     y=~avg_price,
                     type='scatter',
                     mode='markers',
                     size=~avg_price,
                     text = ~paste("Brand: ", brand,
                                    '\nRank: ',round(avg_rank,1),
                                    "\nPrice: ",round(avg_price,2)),
                     hoverinfo = 'text') %>%
  layout(
    title = "Average Price vs Average Rank for each Brand",
    xaxis = list(title="Average Rank"),
    yaxis = list(title="Average Price"))
#p_brand_link = api_create(avg_brand, filename="scatter2d-price_rank_brand")
#p_brand_link
avg_brand
```


# Product Recommendation

